WITH total_enrollment as ((SELECT student_id, course_number, year_, quarter, section_id, faculty_name, unit_taken, grade FROM enrollment) UNION (SELECT * FROM past_enrollment)), qtrgpa as (SELECT year_, quarter, sum(unit_taken) as total_units, sum(number_grade * unit_taken)/sum(unit_taken) as gpa FROM (total_enrollment JOIN grade_conversion ON total_enrollment.grade = grade_conversion.grade) where student_id = 111111111 GROUP BY year_, quarter) SELECT * FROM qtrgpa;